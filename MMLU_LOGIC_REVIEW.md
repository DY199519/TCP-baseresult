# MMLU é€»è¾‘æ£€æŸ¥æŠ¥å‘Š

## 1. æ•´ä½“æµç¨‹æ¦‚è¿°

```
å‚æ•°è§£æ â†’ Agenté…ç½® â†’ æ‹“æ‰‘é…ç½® â†’ å›¾åˆå§‹åŒ– â†’ æ•°æ®é›†æ£€æŸ¥ â†’ è¯„ä¼°æ‰§è¡Œ
```

## 2. å…³é”®é€»è¾‘ç‚¹æ£€æŸ¥

### 2.1 æ•°æ®é›†æ£€æŸ¥é€»è¾‘ï¼ˆç¬¬150-154è¡Œï¼‰

**å½“å‰å®ç°ï¼š**
```python
def check_dataset_exists() -> bool:
    data_path = Path(GDesigner_ROOT) / "datasets" / "MMLU" / "data"
    return data_path.exists() and any(data_path.iterdir()) if data_path.exists() else False
```

**é—®é¢˜ï¼š**
- é€»è¾‘å†—ä½™ï¼š`if data_path.exists() else False` æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºå¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œ`any(data_path.iterdir())` ä¼šæŠ›å‡ºå¼‚å¸¸
- æ›´ç®€æ´çš„å†™æ³•ï¼š`return data_path.exists() and any(data_path.iterdir())`

**å»ºè®®æ”¹è¿›ï¼š**
- ç®€åŒ–æ¡ä»¶åˆ¤æ–­
- å¢åŠ é”™è¯¯å¤„ç†ï¼Œé¿å…è·¯å¾„ä¸å­˜åœ¨æ—¶å‡ºé”™

---

### 2.2 DirectAnsweræ¨¡å¼çš„èŠ‚ç‚¹é…ç½®ï¼ˆç¬¬169-173è¡Œ + ç¬¬143-145è¡Œï¼‰

**å½“å‰å®ç°ï¼š**
1. åœ¨ `main()` ä¸­å…ˆé™åˆ¶ agent_namesï¼ˆç¬¬170-173è¡Œï¼‰
2. åœ¨ `get_node_kwargs()` ä¸­è¿”å›é•¿åº¦ä¸º1çš„åˆ—è¡¨ï¼ˆç¬¬143-145è¡Œï¼‰

**é—®é¢˜ï¼š**
- é€»è¾‘æ‰§è¡Œé¡ºåºï¼šå…ˆé™åˆ¶ agent_namesï¼Œå†è°ƒç”¨ get_node_kwargsï¼Œè¿™æ˜¯æ­£ç¡®çš„
- ä½†æ˜¯ get_node_kwargs çš„æ³¨é‡Šè¯´"DirectAnswer æ¨¡å¼é™¤å¤–ï¼Œè¿”å›é•¿åº¦ä¸º 1"ï¼Œå®é™…é€»è¾‘æ˜¯æ­£ç¡®çš„
- æ½œåœ¨é—®é¢˜ï¼šå¦‚æœä¼ å…¥çš„ N ä¸æ˜¯ 1ï¼Œå‡½æ•°ä¼šè¿”å›é•¿åº¦ä¸º 1 çš„åˆ—è¡¨ï¼Œä½†è°ƒç”¨æ—¶ N åº”è¯¥æ˜¯ 1ï¼ˆå› ä¸ºå·²ç»é™åˆ¶äº† agent_namesï¼‰

**å»ºè®®æ”¹è¿›ï¼š**
- åœ¨ `get_node_kwargs()` ä¸­æ·»åŠ  DirectAnswer æ¨¡å¼çš„éªŒè¯ï¼Œç¡®ä¿ N == 1
- æˆ–è€…åœ¨ main() ä¸­ï¼Œå¦‚æœ mode == DirectAnswerï¼Œç›´æ¥è®¾ç½® node_kwargs è€Œä¸è°ƒç”¨ get_node_kwargs

---

### 2.3 Fakeæ¨¡å¼çš„Roleåˆ†é…é€»è¾‘ï¼ˆç¬¬131-142è¡Œï¼‰

**å½“å‰å®ç°ï¼š**
```python
if 'Fake' in mode:
    if 'AG' not in mode:
        node_kwargs = [
            {'role': 'Fake'} if i % 2 == N % 2 else {'role': 'Normal'} 
            for i in range(N)
        ]
    else:
        node_kwargs = [
            {'role': 'Fake'} if i % 2 == N % 2 else {'role': None} 
            for i in range(N)
        ]
```

**é—®é¢˜åˆ†æï¼š**
- æ¡ä»¶ `i % 2 == N % 2` çš„åˆ†é…è§„åˆ™ï¼š
  - å½“ N ä¸ºå¶æ•°ï¼ˆN%2=0ï¼‰æ—¶ï¼ši=0,2,4... åˆ†é… Fakeï¼Œi=1,3,5... åˆ†é… Normal
  - å½“ N ä¸ºå¥‡æ•°ï¼ˆN%2=1ï¼‰æ—¶ï¼ši=1,3,5... åˆ†é… Fakeï¼Œi=0,2,4... åˆ†é… Normal
- ç¤ºä¾‹ï¼šN=5 â†’ Fakeç´¢å¼•: [1,3], Normalç´¢å¼•: [0,2,4]

**æ½œåœ¨é—®é¢˜ï¼š**
1. é€»è¾‘ä¸å¤Ÿç›´è§‚ï¼Œå¯èƒ½éœ€è¦æ›´æ¸…æ™°çš„æ³¨é‡Šè¯´æ˜åˆ†é…ç­–ç•¥
2. 'AG' æ¨¡å¼çš„å«ä¹‰ä¸æ˜ç¡®ï¼ˆä»£ç ä¸­æ²¡æœ‰çœ‹åˆ° 'FakeXXXAG' æ¨¡å¼çš„ç¤ºä¾‹ï¼‰
3. å¦‚æœ N=1ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ Normalï¼ˆå› ä¸º i % 2 == N % 2 åªæœ‰åœ¨ N=1, i=1 æ—¶æˆç«‹ï¼Œä½† i ä»0å¼€å§‹ï¼‰

**å»ºè®®æ”¹è¿›ï¼š**
- æ˜ç¡® Fake æ¨¡å¼çš„åˆ†é…ç­–ç•¥ï¼ˆæ˜¯å¦å¸Œæœ›è¿‘ä¼¼ 50/50 åˆ†é…ï¼Ÿï¼‰
- æ·»åŠ å•å…ƒæµ‹è¯•éªŒè¯åˆ†é…é€»è¾‘
- å¦‚æœ N=1ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

---

### 2.4 æ‹“æ‰‘ç±»å‹æ˜ å°„ï¼ˆç¬¬87-114è¡Œï¼‰

**å½“å‰å®ç°ï¼š**
- `mode_to_topology_type()` å‡½æ•°å¤„ç† Fake å‰ç¼€å’Œç›´æ¥æ˜ å°„
- æ”¯æŒçš„æ¨¡å¼ï¼š`FullConnected`, `Chain`, `Star`, `DirectAnswer`, `FakeFullConnected`, `FakeChain`, `FakeStar`

**é—®é¢˜ï¼š**
- ä»£ç ä¸­æœ‰ `.replace('AG', '')` å¤„ç†ï¼ˆç¬¬102è¡Œï¼‰ï¼Œä½†å®é™…å‚æ•°é€‰é¡¹ä¸­å¹¶æ²¡æœ‰åŒ…å« 'AG' çš„æ¨¡å¼
- è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—ç•™ä»£ç æˆ–æœªå®ç°çš„ç‰¹æ€§

**å»ºè®®æ”¹è¿›ï¼š**
- å¦‚æœ 'AG' æ¨¡å¼ä¸éœ€è¦ï¼Œå¯ä»¥ç§»é™¤ç›¸å…³ä»£ç 
- æˆ–è€…æ·»åŠ å¯¹åº”çš„æ¨¡å¼åˆ° choices åˆ—è¡¨ä¸­

---

### 2.5 è¯„ä¼°å‡½æ•°è°ƒç”¨ï¼ˆç¬¬234-240è¡Œï¼‰

**å½“å‰å®ç°ï¼š**
```python
score = await evaluate(
    graph=graph,
    dataset=dataset_val,
    num_rounds=args.num_rounds,
    limit_questions=limit_questions,
    eval_batch_size=args.batch_size
)
```

**æ£€æŸ¥ç‚¹ï¼š**
- âœ… å‚æ•°ä¼ é€’æ­£ç¡®
- âœ… ä½¿ç”¨äº†å¼‚æ­¥è¯„ä¼°
- âœ… æ”¯æŒæ‰¹å¤„ç†å’Œé™åˆ¶é—®é¢˜æ•°é‡

---

## 3. æ½œåœ¨é—®é¢˜å’Œæ”¹è¿›å»ºè®®

### 3.1 å…³é”®é—®é¢˜æ±‡æ€»

| é—®é¢˜ | ä½ç½® | ä¸¥é‡ç¨‹åº¦ | å»ºè®® |
|------|------|---------|------|
| æ•°æ®é›†æ£€æŸ¥é€»è¾‘å†—ä½™ | ç¬¬154è¡Œ | ä½ | ç®€åŒ–æ¡ä»¶åˆ¤æ–­ |
| DirectAnsweræ¨¡å¼éªŒè¯ | ç¬¬143-145è¡Œ | ä¸­ | æ·»åŠ  N==1 çš„éªŒè¯ |
| Fakeæ¨¡å¼åˆ†é…é€»è¾‘ä¸ç›´è§‚ | ç¬¬135è¡Œ | ä¸­ | æ·»åŠ æ³¨é‡Šè¯´æ˜ï¼Œæˆ–ä½¿ç”¨æ›´æ¸…æ™°çš„åˆ†é…ç­–ç•¥ |
| 'AG' æ¨¡å¼å¤„ç†æœªä½¿ç”¨ | ç¬¬102è¡Œ | ä½ | ç§»é™¤æˆ–å®ç° |
| ç¼ºå°‘é”™è¯¯å¤„ç† | å¤šå¤„ | ä¸­ | å¢åŠ  try-catch å’Œé”™è¯¯æç¤º |

### 3.2 æ”¹è¿›å»ºè®®

#### å»ºè®®1ï¼šç®€åŒ–æ•°æ®é›†æ£€æŸ¥é€»è¾‘
```python
def check_dataset_exists() -> bool:
    """æ£€æŸ¥ MMLU æ•°æ®é›†æ˜¯å¦å·²å­˜åœ¨"""
    data_path = Path(GDesigner_ROOT) / "datasets" / "MMLU" / "data"
    if not data_path.exists():
        return False
    try:
        return any(data_path.iterdir())
    except (PermissionError, OSError):
        return False
```

#### å»ºè®®2ï¼šæ”¹è¿› DirectAnswer æ¨¡å¼å¤„ç†
```python
def get_node_kwargs(mode: str, N: int) -> List[Dict[str, Any]]:
    """
    æ ¹æ® mode ç”ŸæˆèŠ‚ç‚¹é…ç½®åˆ—è¡¨
    """
    if mode == 'DirectAnswer':
        if N != 1:
            raise ValueError(f"DirectAnswer mode requires exactly 1 agent, got {N}")
        return [{'role': 'Normal'}]
    
    # é»˜è®¤åˆå§‹åŒ–
    node_kwargs: List[Dict[str, Any]] = [{} for _ in range(N)]
    
    if 'Fake' in mode:
        # ... Fake æ¨¡å¼é€»è¾‘
    return node_kwargs
```

#### å»ºè®®3ï¼šæ”¹è¿› Fake æ¨¡å¼åˆ†é…é€»è¾‘ï¼ˆæ›´æ¸…æ™°çš„50/50åˆ†é…ï¼‰
```python
if 'Fake' in mode:
    # äº¤æ›¿åˆ†é… Fake/Normal è§’è‰²ï¼Œè¿‘ä¼¼ 50/50 åˆ†é…
    # å¦‚æœ N ä¸ºå¥‡æ•°ï¼Œåˆ™å¤šä¸€ä¸ª Normal èŠ‚ç‚¹
    node_kwargs = [
        {'role': 'Fake'} if i % 2 == 1 else {'role': 'Normal'}
        for i in range(N)
    ]
    # æˆ–è€…ä½¿ç”¨æ›´æ˜ç¡®çš„ç­–ç•¥ï¼š
    # num_fake = N // 2
    # node_kwargs = [
    #     {'role': 'Fake' if i < num_fake else 'Normal'}
    #     for i in range(N)
    # ]
```

## 4. é€»è¾‘æ­£ç¡®æ€§éªŒè¯

### 4.1 æ­£å¸¸æµç¨‹éªŒè¯

âœ… **FullConnected æ¨¡å¼ï¼ˆ5ä¸ªagentï¼‰**
- agent_names: ['AnalyzeAgent'] * 5
- topology_type: 'full_connected'
- node_kwargs: [{}] * 5
- **é¢„æœŸç»“æœï¼š** 5ä¸ªèŠ‚ç‚¹ï¼Œå…¨è¿æ¥æ‹“æ‰‘ âœ“

âœ… **DirectAnswer æ¨¡å¼**
- agent_names: ['AnalyzeAgent'] (é™åˆ¶ä¸º1)
- topology_type: 'none'
- node_kwargs: [{'role': 'Normal'}]
- **é¢„æœŸç»“æœï¼š** 1ä¸ªèŠ‚ç‚¹ï¼Œæ— æ‹“æ‰‘è¿æ¥ âœ“

âœ… **FakeFullConnected æ¨¡å¼ï¼ˆ5ä¸ªagentï¼‰**
- agent_names: ['AnalyzeAgent'] * 5
- topology_type: 'full_connected'
- node_kwargs: [{'role': 'Fake'} if i % 2 == 1 else {'role': 'Normal'} for i in range(5)]
  - i=0: Normal
  - i=1: Fake
  - i=2: Normal
  - i=3: Fake
  - i=4: Normal
- **é¢„æœŸç»“æœï¼š** 5ä¸ªèŠ‚ç‚¹ï¼ˆ3 Normal, 2 Fakeï¼‰ï¼Œå…¨è¿æ¥æ‹“æ‰‘ âœ“

### 4.2 è¾¹ç•Œæƒ…å†µéªŒè¯

âš ï¸ **DirectAnswer æ¨¡å¼ + å¤šä¸ªagentï¼ˆåº”è¯¥è¢«é™åˆ¶ï¼‰**
- ä¼ å…¥ï¼šagent_names = ['AnalyzeAgent'] * 5
- å¤„ç†ï¼šé™åˆ¶ä¸º 1 ä¸ª
- **çŠ¶æ€ï¼š** æ­£ç¡® âœ“

âš ï¸ **Fake æ¨¡å¼ + 1ä¸ªagent**
- N=1, i=0, i % 2 == N % 2 â†’ 0 == 1 â†’ False
- **ç»“æœï¼š** role = 'Normal'
- **é—®é¢˜ï¼š** å¦‚æœåªæœ‰1ä¸ªagentï¼ŒFakeæ¨¡å¼æ²¡æœ‰æ„ä¹‰ï¼Œå¯èƒ½éœ€è¦è­¦å‘Š

## 5. æ€»ç»“

**æ•´ä½“é€»è¾‘è¯„ä¼°ï¼š** âœ… åŸºæœ¬æ­£ç¡®ï¼Œä½†æœ‰ä¸€äº›å¯ä»¥æ”¹è¿›çš„åœ°æ–¹

**ä¸»è¦ä¼˜ç‚¹ï¼š**
- ä»£ç ç»“æ„æ¸…æ™°
- æ”¯æŒå¤šç§æ¨¡å¼
- æœ‰åŸºæœ¬çš„é”™è¯¯å¤„ç†

**ä¸»è¦æ”¹è¿›ç‚¹ï¼š**
1. ç®€åŒ–æ•°æ®é›†æ£€æŸ¥é€»è¾‘
2. æ·»åŠ  DirectAnswer æ¨¡å¼çš„éªŒè¯
3. æ”¹è¿› Fake æ¨¡å¼çš„åˆ†é…é€»è¾‘ï¼Œä½¿å…¶æ›´ç›´è§‚
4. ç§»é™¤æœªä½¿ç”¨çš„ 'AG' æ¨¡å¼å¤„ç†
5. å¢åŠ è¾¹ç•Œæƒ…å†µçš„å¤„ç†ï¼ˆå¦‚ N=1 æ—¶çš„ Fake æ¨¡å¼ï¼‰

**å»ºè®®ä¼˜å…ˆçº§ï¼š**
1. ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼šæ·»åŠ  DirectAnswer æ¨¡å¼çš„éªŒè¯
2. ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼šæ”¹è¿› Fake æ¨¡å¼åˆ†é…é€»è¾‘çš„å¯è¯»æ€§
3. ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼šç®€åŒ–æ•°æ®é›†æ£€æŸ¥é€»è¾‘ï¼Œç§»é™¤æœªä½¿ç”¨ä»£ç 

